- ## 1. 线程池源码分析
  1. 核心线程数 在线程池创建的时候就会创建核心线程数 一般设置根据两个准则设置
     1. CPU密集型 一般设置为 cpu核心数 + 1 这样在一个线程销毁的情况下或者阻塞的情况下另一个线程能快速运行.同时充分运用了多核性能.
     2. IO密集型 一般设置为 cpu核心数 * 2 + 1 因为IO密集型的话,cpu的使用率并不高,对io的要求比较高,所以当线程在进行io等待的时候可以让cpu切换线程去处理其他的任务.
  2. 最大线程数 最大线程数设置一般设置为
  3. 线程存活时间 线程存活时间不宜过长也不宜过短,过短会导致任务队列满的情况下,频繁的创建线程,销毁线程.这样就有可能导致线程数耗尽的情况.
  4. 线程工厂类 ThreadFactory 主要是做线程的创建操作,可以在创建线程时设置线程名,是否是后台线程,和线程处理失败异常的捕获handler.
  5. 任务阻塞队列 当执行submit方法或者execute方法时,会先将任务保存到阻塞队列中,如果这个时候任务队列放满了,首先是线程数会从核心线程数向最大线程数增加,如果线程数已经达到最大线程数,那么就会执行拒绝策略.
  6. 拒绝策略 ThreadPool 提供了AbortPolicy,DiscardPolicy,CallerRunsPolicy,DiscardOldestPolicy三种拒绝策略.
     1. AbortPolicy 线程池直接抛出异常,当前任务丢弃.
     2. CallerRunsPolicy 当前任务在主线程进行运行.
     3. DiscardOldestPolicy 丢弃老的任务,将新的任务放入队列.
     4. DiscardPolicy 直接丢弃任务
  7. Addahl定律:
     F: 系统串行化比例.
     N: CPU数目.
     speedup: 加速比 加速比越大,系统并行化的效果越好.
     Speedup = 1 / (F + (1-F)/N)
     解释: cpu密集型时,F的指近乎为0,IO密集型时F的值无限接近于1.
  8. 在服务器性能io优化中线程计算法则为:
     最佳线程数目 (线程等待时间 + 线程cpu时间) / 线程cpu时间  * cpu数目
     可以得出结论,线程等待时间占比越高,需要更多线程.线程cpu执行时间越长,需要更少线程.
  9. 在做系统优化时,就要考虑线程池是执行哪类操作,如果是执行CPU密集型,那么就将线程池设置为cpu核心数 + 1,如果是io密集型就将线程数设置高一点.同时也可以通过优化io模型去减少线程的cpu等待时间.
      1. io 优化方案 增强短板操作的并行化比率,比如多线程下载技术.
      2. 用NIO替换io,减少io阻塞时间.    